<!DOCTYPE html>
<html>
<head>
    <title>Global Bank AI</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f4f7f6; display: flex; justify-content: center; padding: 20px; }
        #chat-card { width: 400px; height: 600px; background: white; border-radius: 12px; display: flex; flex-direction: column; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        #messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .bubble { padding: 10px; border-radius: 10px; font-size: 14px; max-width: 80%; }
        .bot { background: #eee; align-self: flex-start; }
        .user { background: #004a99; color: white; align-self: flex-end; }
        form { display: flex; padding: 15px; border-top: 1px solid #eee; gap: 5px; }
        input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; outline: none; }
        button { background: #004a99; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="chat-card">
        <div id="messages"><div class="bubble bot">Hi, I'm Alex from Global Bank. Would you like to explore a Home Loan or a Personal Loan today?</div></div>
        <form id="chat-form">
            <input type="text" id="user-input" placeholder="Message Alex..." autocomplete="off">
            <button type="submit">Send</button>
        </form>
    </div>

    <script>
        const userId = "cust_" + Math.floor(Math.random() * 1000);
        const form = document.getElementById('chat-form');

        form.addEventListener('submit', async (e) => {
            e.preventDefault(); // STOPS REFRESH
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if (!text) return;

            addBubble(text, 'user');
            input.value = "";

            try {
                // Ensure uvicorn is running on 8000
                const res = await fetch('http://127.0.0.1:8000/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, message: text })
                });
                const data = await res.json();
                addBubble(data.reply, 'bot');
            } catch (err) {
                addBubble("Connection Error. Check your terminal.", 'bot');
            }
        });

        function addBubble(text, sender) {
            const div = document.createElement('div');
            div.className = 'bubble ' + sender;
            div.innerText = text;
            document.getElementById('messages').appendChild(div);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }
    </script>
</body>
</html>